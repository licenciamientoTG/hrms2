{% extends 'layouts/base.html' %}
{% load static %}

{% block page_title %}{% if is_edit %}Editar ciclo · Objetivos{% else %}Nuevo ciclo · Objetivos{% endif %}{% endblock %}

{% block styles %}
  <link rel="stylesheet" href="{% static 'css/objectives.css' %}">
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="mb-0">
    {% if is_edit %}Editar ciclo{% else %}Nuevo ciclo{% endif %}
  </h2>
</div>

<div class="card p-4">

  <!-- PASOS -->
  <div class="d-flex align-items-center mb-4 gap-3">
    <div class="step-dot step-1 active">1</div>
    <div class="flex-grow-1 border-top"></div>
    <div class="step-dot step-2">2  </div>
    <div class="flex-grow-1 border-top"></div>
    <div class="step-dot step-3">3</div>
  </div>

  {# action del form #}
  <form method="post"
        action="{% if is_edit %}{% url 'obj_cycle_edit' obj.id %}{% else %}{% url 'obj_cycle_create' %}{% endif %}"
        novalidate>
  {% csrf_token %}

    {% if messages %}
      {% for m in messages %}
        <div class="alert alert-{{ m.tags }} mb-3">{{ m }}</div>
      {% endfor %}
    {% endif %}

    <!-- STEP 1 -->
    <section class="js-step" data-step="1">
      <div class="mb-3">
        <label for="cycleName" class="form-label">Nombre <span class="text-danger">*</span></label>
        <input id="cycleName" type="text" name="name" class="form-control"
              placeholder="Ej. Nuevo ciclo de objetivos Mensual"
              value="{{ formdata.name|default:'' }}" required>
        <div class="invalid-feedback">El nombre es obligatorio.</div>
      </div>
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Fecha de inicio</label>
          <input type="date" name="start_date" class="form-control"
                value="{{ formdata.start_date|default:'' }}">
        </div>
        <div class="col-md-6">
          <label class="form-label">Fecha de fin</label>
          <input type="date" name="end_date" class="form-control"
                value="{{ formdata.end_date|default:'' }}">
        </div>
      </div>
    </section>

    <!-- STEP 2 -->
    <section class="js-step d-none" data-step="2">
      <div class="form-check form-switch mb-3">
        <input class="form-check-input" type="checkbox" role="switch"
              id="limitSwitch" name="limit_enabled"
              {% if formdata.limit_enabled %}checked{% endif %}>
        <label class="form-check-label" for="limitSwitch">Límite de objetivos</label>
        <div class="text-muted small">Defina la cantidad mínima y máxima de objetivos por colaborador.</div>
      </div>

      <div id="limitBox" class="row g-3 {% if not formdata.limit_enabled %}d-none{% endif %}">
        <div class="col-md-6">
          <label class="form-label">Mínimo</label>
          <input type="number" name="min_objectives" class="form-control" min="0" placeholder="0"
                value="{{ formdata.min_objectives|default:'' }}">
        </div>
        <div class="col-md-6">
          <label class="form-label">Máximo</label>
          <input type="number" name="max_objectives" class="form-control" min="0" placeholder="0"
                value="{{ formdata.max_objectives|default:'' }}">
        </div>
      </div>
    </section>

    <!-- STEP 3: Validación -->
    <section class="js-step d-none" data-step="3">
      <h5 class="mb-3">Validación</h5>
      <div class="list-group">
        <div class="list-group-item d-flex justify-content-between">
          <span class="text-muted">Nombre del ciclo</span>
          <strong id="sumName">—</strong>
        </div>
        <div class="list-group-item d-flex justify-content-between">
          <span class="text-muted">Fecha de inicio</span>
          <strong id="sumStart">—</strong>
        </div>
        <div class="list-group-item d-flex justify-content-between">
          <span class="text-muted">Fecha de fin</span>
          <strong id="sumEnd">—</strong>
        </div>
        <div class="list-group-item d-flex justify-content-between">
          <span class="text-muted">Cantidad de objetivos por colaborador</span>
          <strong id="sumLimit">Ilimitados</strong>
        </div>
      </div>
    </section>

    <!-- Footer botones -->
    <div class="d-flex justify-content-between mt-4">
      <a id="btnPrev" href="{% url 'admin_objective' %}" class="btn btn-outline-secondary">Anterior</a>

      <div class="d-flex gap-2">
        <button type="button" class="btn btn-primary js-next">Continuar</button>
        <button type="submit" class="btn btn-primary d-none js-finish">
          {% if is_edit %}Guardar cambios{% else %}Finalizar{% endif %}
        </button>
      </div>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/objectives.js' %}"></script>
{% endblock %}
