{% extends 'layouts/base.html' %}
{% load static %}
{% block page_title %}Noticias{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="mb-0">Noticias</h2>
  <a href="{% url 'news_create' %}" class="btn btn-primary">+ Nueva noticia</a>
</div>

<div class="card p-3">
  <form class="mb-3" method="get">
    <input type="text" name="q" value="{{ q }}" class="form-control" placeholder="🔍 Buscar por título de noticia">
  </form>

  <table class="table table-hover align-middle" id="admin-news-table">
    <thead>
      <tr>
        <th>Título</th>
        <th>Fecha</th>
        <th>Creador</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for noticia in news %}
        <tr>
          <td>
              {{ noticia.title|truncatechars:80 }}
          </td>
          <td>
            {% if noticia.publish_at %}
              {{ noticia.publish_at|date:"d/m/Y H:i" }}
            {% else %}
              {{ noticia.published_at|date:"d/m/Y H:i" }}
            {% endif %}
          </td>
          <td>{{ noticia.author|default:"—" }}</td>
          <td>
            <div class="dropdown">
              <a class="btn btn-link dropdown-toggle" data-bs-toggle="dropdown">⋮</a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="{% url 'news_detail_admin' noticia.id %}">Editar</a></li>
                <li>
                  <form method="post" action="{% url 'news_delete' noticia.id %}" class="delete-news-form">
                    {% csrf_token %}
                    <button type="button"
                            class="dropdown-item text-danger w-100 text-start js-delete-news"
                            data-title="{{ noticia.title|escape }}"
                            data-ajax="0"> 
                      Eliminar
                    </button>
                  </form>
                </li>
              </ul>
            </div>
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="5" class="text-center">No hay noticias aún.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
  <script src="{% static 'js/news.js' %}"></script>
{% endblock %}
