{% extends 'layouts/base.html' %}
{% load static %}
{% block page_title %}{{ n.title }}{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/news.css' %}">
{% endblock %}

{% block content %}


<div class="mb-3">
  <a href="{% url 'user_news' %}" class="btn btn-light">← Volver</a>
</div>

<article class="article-card">
  {% if n.cover_image %}
    <img class="article-cover mb-3" src="{{ n.cover_image.url }}" alt="Portada">
  {% endif %}

  <h1 class="mb-2" style="font-weight:800;line-height:1.2">{{ n.title }}</h1>

  <div class="muted mb-3">🕒 Hace {{ n.published_at|timesince }}</div>

  <div class="d-flex flex-wrap gap-2 mb-4">
    {% for t in n.tags.all %}<span class="chip">{{ t.name }}</span>{% empty %}{% endfor %}
  </div>

  <!-- Contenido HTML del editor -->
  <!-- 👇 le añadimos la clase news-content para aplicar el CSS y el script -->
  <div class="news-content mb-4" style="font-size:1.05rem;line-height:1.7">
    {{ n.content|safe }}
  </div>

  <hr class="my-4">
  <!-- Acciones/placeholder -->
  <div class="d-flex align-items-center gap-3">
    <button type="button"
            class="btn btn-sm rounded-3 btn-like border-0 shadow-none
                  {% if n.my_liked %}btn-success text-white{% else %}btn-light{% endif %}"
            data-url="{% url 'news_like_toggle' n.id %}"
            aria-pressed="{{ n.my_liked|yesno:'true,false' }}">
      👍 <span class="like-count">{{ n.like_count }}</span>
    </button>
    <span title="Comentarios">💬 <span class="comment-count">{{ n.comment_count }}</span></span>
  </div>

  <hr class="my-4">

  <h5 class="mb-3">Comenta</h5>

  <form id="comment-form"
        method="post"
        data-url="{% url 'news_comment_create' n.id %}"
        class="d-flex align-items-center gap-2 mt-2">
    {% csrf_token %}
    <input type="text"
          name="body"
          class="form-control"
          placeholder="Escribe un comentario..."
          required>
    <button type="submit" class="btn btn-primary">Enviar</button>
  </form>

  <div id="comments">
    {% if n.comments.exists %}
      {% for c in n.comments.all %}
        {% include 'news/user/_comment.html' with c=c %}
      {% endfor %}
      {% else %}
      <div class="text-muted">Sé el primero en comentar.</div>
    {% endif %}
  </div>
</article>
{% endblock %}
{% block scripts %}
  <script src="{% static 'js/news.js' %}"></script>
{% endblock %}
