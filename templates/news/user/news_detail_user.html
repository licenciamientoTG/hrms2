{% extends 'layouts/base.html' %}
{% load static %}
{% block page_title %}{{ n.title }}{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/news.css' %}">
{% endblock %}

{% block content %}


<div class="mb-3">
  <a href="{% url 'user_news' %}" class="btn btn-light">← Volver</a>
</div>

<article class="article-card">
  {% if n.cover_image %}
    <img class="article-cover mb-3" src="{{ n.cover_image.url }}" alt="Portada">
  {% endif %}

  <h1 class="mb-2" style="font-weight:800;line-height:1.2">{{ n.title }}</h1>

  <div class="muted mb-3">🕒 Hace {{ n.published_at|timesince }}</div>

  <div class="d-flex flex-wrap gap-2 mb-4">
    {% for t in n.tags.all %}<span class="chip">{{ t.name }}</span>{% empty %}{% endfor %}
  </div>

  <!-- Contenido HTML del editor -->
  <!-- 👇 le añadimos la clase news-content para aplicar el CSS y el script -->
  <div class="news-content mb-4" style="font-size:1.05rem;line-height:1.7">
    {{ n.content|safe }}
  </div>

  {% if n.attachments %}
    <div class="mt-3">
      📎 <a href="{{ n.attachments.url }}" target="_blank" rel="noopener">Descargar adjunto</a>
    </div>
  {% endif %}

  <hr class="my-4">

  <!-- Acciones/placeholder -->
  <div class="d-flex align-items-center gap-3">
    <button class="btn btn-outline-secondary btn-sm" type="button" id="copyLinkBtn">🔗 Copiar enlace</button>
    <span class="muted">👍 0</span>
    <span class="muted">💬 0</span>
  </div>
</article>

<script>
  // Copiar enlace
  document.getElementById('copyLinkBtn')?.addEventListener('click', async () => {
    try { await navigator.clipboard.writeText(window.location.href); alert('Enlace copiado'); }
    catch { alert('No se pudo copiar'); }
  });

  // ✅ Añade class="img-fluid" a todas las <img> ya renderizadas y limpia dimensiones fijas
  document.querySelectorAll('.news-content img').forEach(img => {
    img.classList.add('img-fluid');      // bootstrap
    img.removeAttribute('width');
    img.removeAttribute('height');
    img.style.width = '';
    img.style.height = '';
    if (!img.hasAttribute('loading')) img.setAttribute('loading','lazy'); // opcional: performance
  });
</script>
{% endblock %}
