{% extends 'layouts/base.html' %}
{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/org_chart.css' %}">
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
  rel="stylesheet"
/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/orgchart/2.1.3/css/jquery.orgchart.min.css">
{% endblock %}

{% block page_title %}Organigrama{% endblock %}
{% block title %}Organigrama{% endblock %}

{% block content %}

  {# ğŸ” Barra de bÃºsqueda (opcional, si la quieres tambiÃ©n en usuario) #}
  <div class="orgchart-search"
       style="margin-bottom: 10px; display:flex; align-items:center; justify-content:space-between;">

    <div>
      <input id="orgchart-search-input"
             type="text"
             placeholder="Buscar colaborador..."
             style="max-width: 300px; padding: 6px 8px; border-radius: 4px; border: 1px solid #ccc;">

      <button id="orgchart-search-btn"
              type="button"
              style="padding: 6px 12px; margin-left: 4px; border-radius: 4px; border: 1px solid #007bff; background:#007bff; color:white;">
        Buscar
      </button>

      <small id="orgchart-search-result" style="margin-left:10px; color:#888;"></small>
    </div>
  </div>

  {# ğŸ”¹ Contenedor del organigrama #}
  {% include "org_chart/_base_chart.html" %}

  {# ğŸ”¹ Controles flotantes (zoom / fit / ir a mÃ­) #}
  <div class="orgchart-controls">
    <button id="oc-zoom-in"  class="oc-btn" title="Acercar">
      <i class="fas fa-plus"></i>
    </button>
    <button id="oc-zoom-out" class="oc-btn" title="Alejar">
      <i class="fas fa-minus"></i>
    </button>
    <button id="oc-fit" class="oc-btn" title="Ajustar a pantalla">
      <i class="fas fa-expand"></i>
    </button>
    <button id="oc-center-me" type="button" class="oc-btn" title="Ir a mi posiciÃ³n">
      <i class="fas fa-user"></i>
    </button>
  </div>

  {# ğŸ”¹ Panel lateral (el mismo que en admin) #}
  <div id="profile-panel" class="profile-panel">
    <div class="profile-panel-header">
      <button id="profile-close" class="profile-close">&times;</button>
      <div id="profile-name" class="profile-name">Nombre</div>
      <div class="profile-avatar-wrapper">
        <img id="profile-photo" src="" alt="Foto" class="profile-avatar">
      </div>
    </div>
    <div class="profile-panel-body">
      <div class="profile-item">
        <div class="profile-label">Puesto</div>
        <div id="profile-title" class="profile-value"></div>
      </div>
      <div class="profile-item">
        <div class="profile-label">Departamento</div>
        <div id="profile-dept" class="profile-value"></div>
      </div>
      <div class="profile-item">
        <div class="profile-label">Equipo</div>
        <div id="profile-team" class="profile-value"></div>
      </div>
      <div class="profile-item">
        <div class="profile-label">Jefe directo</div>
        <div id="profile-responsible" class="profile-value"></div>
      </div>
    </div>
  </div>

{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/orgchart/2.1.3/js/jquery.orgchart.min.js"></script>
<script>
  window.ORGCHART_DATA_URL = "{% url 'org_chart_data_1' %}";
  window.ORGCHART_ME_EMPLOYEE_NUMBER = "{{ request.user.employee.employee_number|default_if_none:'' }}";
  // NOTA: NO ponemos ORGCHART_MOVE_URL aquÃ­ => modo USUARIO (solo ver, sin drag)
</script>

<script src="{% static 'js/org_chart.js' %}"></script>
{% endblock %}
