{% extends 'layouts/base.html' %}
{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/org_chart.css' %}">
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
  rel="stylesheet"
/>
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/orgchart/2.1.3/css/jquery.orgchart.min.css">
<style>
  #chart-container {
      border: 1px solid #ccc;
      border-radius: 8px;
      overflow: auto;
      margin-top: 10px;
  }

  .orgchart .node {
      border-radius: 10px;
      padding: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,.15);
  }

  .orgchart .title {
      background-color: transparent !important;
      font-weight: 600;
      font-size: 14px;
  }

  .orgchart .content {
      font-size: 12px;
      line-height: 1.3;
  }

  .avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 4px;
  }
</style>
{% endblock %}

{% block page_title %}Organigrama{% endblock %}
{% block title %}Organigrama{% endblock %}

{% block content %}
  {% include "org_chart/_base_chart.html" %}
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/orgchart/2.1.3/js/jquery.orgchart.min.js"></script>

<script>
  $(function () {
    $.getJSON("{% url 'org_chart_data_1' %}", function (datasource) {

      $('#chart-container').orgchart({
        data: datasource,
        nodeId: 'id',
        nodeTitle: 'name',
        nodeContent: 'title',
        pan: true,
        zoom: true,
        draggable: false,   // <-- usuario NO puede mover
        createNode: function ($node, data) {
          const $title = $node.children('.title');
          const $content = $node.children('.content');

          let html = '';

          if (data.photo) {
            html += '<img class="avatar" src="' + data.photo + '">';
          }

          html += '<div><strong>' + (data.name || '') + '</strong></div>';

          if (data.title) {
            html += '<div>' + data.title + '</div>';
          }
          if (data.department) {
            html += '<div>' + data.department + '</div>';
          }
          if (data.company) {
            html += '<div>' + data.company + '</div>';
          }

          $title.text('');
          $content.html(html);
        }
      });

    }).fail(function (err) {
      console.error("Error cargando organigrama (usuario):", err);
    });
  });
</script>
{% endblock %}
