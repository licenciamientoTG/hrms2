{% extends 'layouts/base.html' %}
{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/org_chart.css' %}">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/orgchart/2.1.3/css/jquery.orgchart.min.css">
{% endblock %}


{% block page_title %}Organigrama{% endblock %}
{% block title %}Organigrama{% endblock %}

{% block content %}
<div class="orgchart-search"
     style="margin-bottom: 10px; display:flex; align-items:center; justify-content:space-between;">

  <!-- LADO IZQUIERDO: buscador -->
  <div>
    <input id="orgchart-search-input"
           type="text"
           placeholder="Buscar colaborador..."
           style="max-width: 300px; padding: 6px 8px; border-radius: 4px; border: 1px solid #ccc;">

    <button id="orgchart-search-btn"
            type="button"
            style="padding: 6px 12px; margin-left: 4px; border-radius: 4px; border: 1px solid #007bff; background:#007bff; color:white;">
      Buscar
    </button>

    <small id="orgchart-search-result" style="margin-left:10px; color:#888;"></small>
  </div>
</div>


  {% include "org_chart/_base_chart.html" %}

  <!-- Controles flotantes de zoom / vista -->
  <div class="orgchart-controls">
    <button id="oc-zoom-in"  class="oc-btn" title="Acercar">
      <i class="fas fa-plus"></i>
    </button>
    <button id="oc-zoom-out" class="oc-btn" title="Alejar">
      <i class="fas fa-minus"></i>
    </button>
    <button id="oc-fit" class="oc-btn" title="Ajustar a pantalla">
      <i class="fas fa-expand"></i>
    </button>
    <button id="oc-center-me" type="button" class="oc-btn">
      <i class="fas fa-user"></i>
    </button>
  </div>

  <!-- ðŸ”¹ Panel lateral para la tarjeta de presentaciÃ³n -->
  <div id="profile-panel" class="profile-panel">
    
    <div class="profile-panel-header">
      <button id="profile-close" class="profile-close">&times;</button>
      
      <div class="profile-avatar-wrapper">
        <img id="profile-photo" src="" alt="Foto" class="profile-avatar">
      </div>
    </div>

    <div class="profile-panel-body">
      
      <div id="profile-name" class="profile-name">Nombre del Colaborador</div>

      <div class="profile-item">
        <div class="profile-label">Puesto</div>
        <div id="profile-title" class="profile-value"></div>
      </div>
      <div class="profile-item">
        <div class="profile-label">Departamento</div>
        <div id="profile-dept" class="profile-value"></div>
      </div>
      <div class="profile-item">
        <div class="profile-label">Equipo</div>
        <div id="profile-team" class="profile-value"></div>
      </div>
      <div class="profile-item">
        <div class="profile-label">Jefe directo</div>
        <div id="profile-responsible" class="profile-value"></div>
      </div>
    </div>
  </div>
{% endblock %}


{% block scripts %}


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/orgchart/2.1.3/js/jquery.orgchart.min.js"></script>

  <script>
    window.ORGCHART_DATA_URL = "{% url 'org_chart_data_1' %}";
    window.ORGCHART_MOVE_URL = "{% url 'api_move_position' %}";
    window.ORGCHART_CSRF = "{{ csrf_token }}";

    window.ORGCHART_ME_EMPLOYEE_NUMBER =
      "{{ request.user.employee.employee_number|default_if_none:'' }}";
  </script>

<script src="{% static 'js/org_chart.js' %}"></script>
{% endblock %}
