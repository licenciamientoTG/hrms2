{% extends 'layouts/base.html' %}
{% load static %}
{% block page_title %}Pol√≠ticas Internas{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="mb-0">Pol√≠ticas Internas</h2>
  <a href="" class="btn btn-primary">+ Nueva pol√≠tica</a>
</div>

<div class="card p-3">
  <form class="mb-3" method="get">
    <input type="text" name="q" value="{{ q }}" class="form-control" placeholder="üîç Buscar por t√≠tulo de pol√≠tica">
  </form>

  <table class="table table-hover align-middle" id="admin-policies-table">
    <thead>
      <tr>
        <th>T√≠tulo</th>
        <th>Actualizada</th>
        <th>Creador</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for p in policies %}
        <tr>
          <td>
            {{ p.title|truncatechars:80 }}
          </td>
          <td>
            {{ p.updated_at|date:"d/m/Y H:i" }}
          </td>
          <td>{{ p.owner|default:p.created_by|default:"‚Äî" }}</td>
          <td>
            <div class="dropdown">
              <a class="btn btn-link dropdown-toggle" data-bs-toggle="dropdown">‚ãÆ</a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="{% url 'policies_detail_admin' p.id %}">Editar</a></li>
                <li>
                  <form method="post" action="{% url 'policies_delete' p.id %}" class="delete-policy-form">
                    {% csrf_token %}
                    <button type="button"
                            class="dropdown-item text-danger w-100 text-start js-delete-policy"
                            data-title="{{ p.title|escape }}"
                            data-ajax="0">
                      Eliminar
                    </button>
                  </form>
                </li>
              </ul>
            </div>
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="5" class="text-center">No hay pol√≠ticas registradas a√∫n.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
  <script src="{% static 'js/policies.js' %}"></script>
{% endblock %}
